<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 1. ç§»é™¤ user-scalable=no å…è®¸é¡µé¢ç¼©æ”¾ï¼Œä¿ç•™åŸºç¡€è§†å£è®¾ç½® -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="no-referrer">
    <meta name="format-detection" content="telephone=no,email=no">
    <title>å…ˆé”‹éŸ³ä¹</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* 2. æ·»åŠ æ­Œè¯å›¾ç‰‡ç¼©æ”¾æ ·å¼ */
        .lyric-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .lyric-img {
            max-width: 100%;
            max-height: 80vh;
            /* å…è®¸å›¾ç‰‡è¢«ç¼©æ”¾ */
            touch-action: manipulation;
            /* å¯ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œæå‡ç¼©æ”¾æµç•…åº¦ */
            transform: translateZ(0);
            /* åˆå§‹æ ·å¼ */
            transition: transform 0.2s ease;
        }
        
        .close-lyric {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
            border-radius: 50px;
        }
        
        /* é€‚é…ç§»åŠ¨ç«¯ç‚¹å‡»æ•ˆæœ */
        .close-lyric:active {
            background: rgba(0, 0, 0, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ§ å…ˆé”‹éŸ³ä¹ ğŸ§</h1>
        </header>

        <div class="type-filter">
            <button class="filter-btn active" onclick="filterMusic('all')">å…¨éƒ¨æ­Œæ›²</button>
            <button class="filter-btn" onclick="filterMusic('åŸåˆ›éŸ³ä¹')">åŸåˆ›éŸ³ä¹</button>
            <button class="filter-btn" onclick="filterMusic('æµè¡ŒéŸ³ä¹')">æµè¡ŒéŸ³ä¹</button>
            <button class="filter-btn" onclick="filterMusic('è½»éŸ³ä¹')">è½»éŸ³ä¹</button>
        </div>

        <div class="music-library" id="musicLibrary"></div>

        <div class="player-box">
            <div id="lyricLayer" class="lyric-layer" style="display:none;">
                <img id="lyricImg" src="" alt="æ­Œè¯å›¾ç‰‡" class="lyric-img">
                <div class="close-lyric" onclick="toggleLyric()">âœ– å…³é—­æ­Œè¯</div>
            </div>
            
            <div class="player-controls">
                <audio id="globalPlayer" controls="controls" preload="auto" loop="loop"></audio>
                <button id="lyricBtn" class="lyric-btn" onclick="toggleLyric()" style="display:none;">ğŸ“– æ˜¾ç¤ºæ­Œè¯</button>
            </div>
            <div class="player-info" id="playerInfo">è¯·ç‚¹å‡»æ­Œæ›²æ’­æ”¾</div>
        </div>
    </div>

    <!-- âœ… ä¿®å¤æ ¸å¿ƒï¼šå…ˆè°ƒç”¨JSONï¼ˆå·²æ”¹ä¸ºJSå˜é‡æ ¼å¼ï¼‰ï¼Œå†è°ƒç”¨è„šæœ¬ï¼Œé¡ºåºä¸èƒ½åï¼ -->
    <script src="js/musicdb.json"></script>
    <script src="js/script.js"></script>
    
    <!-- 3. æ·»åŠ å›¾ç‰‡ç¼©æ”¾äº¤äº’è„šæœ¬ï¼ˆå¦‚æœéœ€è¦æ›´æµç•…çš„è‡ªå®šä¹‰ç¼©æ”¾ï¼Œå¯ä»¥æ·»åŠ è¿™ä¸ªï¼‰ -->
    <script>
        // ç®€å•çš„å›¾ç‰‡ç¼©æ”¾å¢å¼ºï¼ˆå¯é€‰ï¼‰
        let scale = 1;
        const lyricImg = document.getElementById('lyricImg');
        
        // åŒæŒ‡ç¼©æ”¾äº‹ä»¶ç›‘å¬
        lyricImg.addEventListener('wheel', function(e) {
            // æ»šè½®ç¼©æ”¾ï¼ˆç”µè„‘ç«¯ï¼‰
            e.preventDefault();
            scale += e.deltaY * -0.001;
            scale = Math.min(Math.max(0.5, scale), 5);
            this.style.transform = `scale(${scale})`;
        });
        
        // ç§»åŠ¨ç«¯è§¦æ‘¸ç¼©æ”¾ï¼ˆå¯é€‰å¢å¼ºï¼‰
        let touchStart = {};
        lyricImg.addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                // è®¡ç®—åˆå§‹ä¸¤ç‚¹è·ç¦»
                touchStart.x = e.touches[0].clientX - e.touches[1].clientX;
                touchStart.y = e.touches[0].clientY - e.touches[1].clientY;
                touchStart.distance = Math.sqrt(touchStart.x * touchStart.x + touchStart.y * touchStart.y);
                touchStart.scale = scale;
            }
        });
        
        lyricImg.addEventListener('touchmove', function(e) {
            if (e.touches.length === 2) {
                e.preventDefault();
                // è®¡ç®—å½“å‰ä¸¤ç‚¹è·ç¦»
                const x = e.touches[0].clientX - e.touches[1].clientX;
                const y = e.touches[0].clientY - e.touches[1].clientY;
                const distance = Math.sqrt(x * x + y * y);
                // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                scale = (distance / touchStart.distance) * touchStart.scale;
                scale = Math.min(Math.max(0.5, scale), 5);
                this.style.transform = `scale(${scale})`;
            }
        });
        
        // å…³é—­æ­Œè¯æ—¶é‡ç½®ç¼©æ”¾
        function resetLyricScale() {
            scale = 1;
            lyricImg.style.transform = 'scale(1)';
        }
        
        // ä¿®æ”¹toggleLyricå‡½æ•°ï¼Œæ·»åŠ é‡ç½®ç¼©æ”¾
        const originalToggleLyric = window.toggleLyric;
        window.toggleLyric = function() {
            const lyricLayer = document.getElementById('lyricLayer');
            if (lyricLayer.style.display === 'none') {
                // æ‰“å¼€æ­Œè¯æ—¶é‡ç½®ç¼©æ”¾
                resetLyricScale();
            }
            // æ‰§è¡ŒåŸæ¥çš„toggleLyricå‡½æ•°
            if (originalToggleLyric) originalToggleLyric();
        };
    </script>
</body>
</html>
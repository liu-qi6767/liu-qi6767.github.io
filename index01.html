<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="no-referrer">
    <meta name="format-detection" content="telephone=no,email=no">
    <title>å…ˆé”‹éŸ³ä¹</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* æ­Œè¯å±‚æ ¸å¿ƒæ ·å¼ï¼šå±…ä¸­é“ºæ»¡å±å¹•+æ”¯æŒç¼©æ”¾+ç‚¹å‡»å…³é—­ */
        .lyric-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;  /* è§†å£å®½åº¦100% */
            height: 100vh; /* è§†å£é«˜åº¦100% */
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0; /* å»æ‰å†…è¾¹è·ï¼Œé¿å…ç•™ç™½ */
            box-sizing: border-box;
        }
        
        .lyric-img {
            width: 100vw;  /* é“ºæ»¡å±å¹•å®½åº¦ */
            height: 100vh; /* é“ºæ»¡å±å¹•é«˜åº¦ */
            object-fit: contain; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ï¼Œå®Œæ•´æ˜¾ç¤ºä¸æ‹‰ä¼¸ */
            cursor: pointer; /* æç¤ºç‚¹å‡»å¯å…³é—­ */
            touch-action: manipulation; /* æ”¯æŒè§¦æ‘¸ç¼©æ”¾ */
            transform-origin: center; /* ç¼©æ”¾ä¸­å¿ƒä¸ºå›¾ç‰‡ä¸­é—´ */
            transition: transform 0.2s ease; /* ç¼©æ”¾è¿‡æ¸¡æµç•… */
        }
        
        .close-lyric {
            position: absolute;
            top: 15px;
            right: 15px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 12px;
            border-radius: 50px;
            z-index: 1001; /* é«˜äºå›¾ç‰‡ï¼Œé¿å…è¢«é®æŒ¡ */
        }
        .close-lyric:active {
            background: rgba(0, 0, 0, 0.8);
        }

        /* æ˜¾ç¤ºæ­Œè¯æŒ‰é’®ï¼šç¼©å°å°ºå¯¸+ç‹¬ç«‹ä¸€è¡Œï¼ˆé¿å…æ‹¥æŒ¤ï¼‰ */
        .lyric-btn {
            width: 50px;  /* ç¼©å°å®½åº¦ */
            height: 28px; /* ç¼©å°é«˜åº¦ */
            font-size: 12px;/* ç¼©å°å­—ä½“ */
            padding: 0;    /* å»æ‰å†…è¾¹è· */
            border: none;
            background: #2196F3;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px auto 10px; /* ä¸Šä¸‹é—´è·ï¼Œå±…ä¸­æ˜¾ç¤º */
            display: block; /* å—çº§å…ƒç´ ï¼Œç‹¬ç«‹ä¸€è¡Œ */
        }
        .lyric-btn:active {
            background: #1976D2;
        }

        /* æ’­æ”¾æ§åˆ¶æ¡ï¼šç²¾ç®€å¸ƒå±€+é€‚é…æ‰‹æœº */
        .player-controls {
            width: 100%;
            display: flex;
            flex-direction: column; /* æ­Œè¯æŒ‰é’®ä¸Šç§»ï¼Œç‹¬ç«‹ä¸€è¡Œ */
            align-items: center;
            gap: 8px; /* å…ƒç´ é—´è· */
        }
        /* éšè—åŸç”Ÿaudioæ§ä»¶ï¼Œç”¨è‡ªå®šä¹‰æ§ä»¶æ›¿ä»£ï¼ˆè§£å†³å†—ä½™åŠŸèƒ½é—®é¢˜ï¼‰ */
        #globalPlayer {
            display: none;
        }
        /* è‡ªå®šä¹‰æ’­æ”¾æ§åˆ¶å®¹å™¨ï¼šæ’­æ”¾/åœæ­¢æŒ‰é’® + è¿›åº¦æ¡ */
        .custom-player {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 10px; /* æŒ‰é’®å’Œè¿›åº¦æ¡é—´è· */
        }
        /* æ’­æ”¾/åœæ­¢åˆ‡æ¢æŒ‰é’® */
        .play-stop-btn {
            width: 60px;
            height: 32px;
            font-size: 14px;
            border: none;
            background: #FF6700;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0; /* ä¸å‹ç¼©ï¼Œå›ºå®šå®½åº¦ */
        }
        .play-stop-btn:active {
            background: #e55a00;
        }
        /* ç²¾ç®€è¿›åº¦æ¡ï¼šé€‚é…æ‰‹æœºï¼Œå æ»¡å‰©ä½™ç©ºé—´ */
        .progress-bar {
            flex: 1; /* å æ»¡å‰©ä½™å®½åº¦ */
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: #eee;
            border-radius: 3px;
            outline: none;
        }
        .progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #FF6700;
            cursor: pointer;
        }

        /* æ’­æ”¾å™¨ä¿¡æ¯åŒºå¾®è°ƒ */
        .player-info {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ§ å…ˆé”‹éŸ³ä¹ ğŸ§</h1>
        </header>

        <div class="type-filter">
            <button class="filter-btn active" onclick="filterMusic('all')">å…¨éƒ¨æ­Œæ›²</button>
            <button class="filter-btn" onclick="filterMusic('åŸåˆ›éŸ³ä¹')">åŸåˆ›éŸ³ä¹</button>
            <button class="filter-btn" onclick="filterMusic('æµè¡ŒéŸ³ä¹')">æµè¡ŒéŸ³ä¹</button>
            <button class="filter-btn" onclick="filterMusic('è½»éŸ³ä¹')">è½»éŸ³ä¹</button>
        </div>

        <div class="music-library" id="musicLibrary"></div>

        <div class="player-box">
            <!-- æ­Œè¯å±‚ï¼šå±…ä¸­é“ºæ»¡å±å¹• -->
            <div id="lyricLayer" class="lyric-layer" style="display:none;">
                <img id="lyricImg" src="" alt="æ­Œè¯å›¾ç‰‡" class="lyric-img" onclick="toggleLyric()">
                <div class="close-lyric" onclick="toggleLyric()">âœ– å…³é—­</div>
            </div>
            
            <!-- æ’­æ”¾æ§åˆ¶åŒºï¼šæ­Œè¯æŒ‰é’®ç‹¬ç«‹ä¸€è¡Œ+ç²¾ç®€æ§åˆ¶æ¡ -->
            <div class="player-controls">
                <!-- æ˜¾ç¤ºæ­Œè¯æŒ‰é’®ï¼šç¼©å°+ç‹¬ç«‹ä¸€è¡Œ -->
                <button id="lyricBtn" class="lyric-btn" onclick="toggleLyric()" style="display:none;">ğŸ“– æ­Œè¯</button>
                <!-- åŸç”Ÿaudioï¼ˆéšè—ï¼‰ -->
                <audio id="globalPlayer" preload="auto" loop="loop"></audio>
                <!-- è‡ªå®šä¹‰ç²¾ç®€æ§åˆ¶æ¡ï¼šæ’­æ”¾/åœæ­¢ + è¿›åº¦æ¡ -->
                <div class="custom-player">
                    <button class="play-stop-btn" id="playStopBtn" onclick="togglePlayStop()">æ’­æ”¾</button>
                    <input type="range" class="progress-bar" id="progressBar" min="0" max="100" value="0">
                </div>
            </div>
            <div class="player-info" id="playerInfo">è¯·ç‚¹å‡»æ­Œæ›²æ’­æ”¾</div>
        </div>
    </div>

    <!-- åŠ è½½æ­Œæ›²åº“å’Œæ ¸å¿ƒè„šæœ¬ -->
    <script src="js/musicdb.json"></script>
    <script src="js/script.js"></script>

    <!-- æ–°å¢ï¼šæ­Œè¯ç¼©æ”¾+è‡ªå®šä¹‰æ’­æ”¾æ§åˆ¶æ ¸å¿ƒè„šæœ¬ -->
    <script>
        // å…¨å±€å˜é‡ï¼šæ’­æ”¾å™¨ã€è¿›åº¦æ¡ã€æ’­æ”¾çŠ¶æ€ã€ç¼©æ”¾æ¯”ä¾‹
        const player = document.getElementById('globalPlayer');
        const progressBar = document.getElementById('progressBar');
        const playStopBtn = document.getElementById('playStopBtn');
        const lyricImg = document.getElementById('lyricImg');
        let isPlaying = false; // æ’­æ”¾çŠ¶æ€ï¼šfalse-æœªæ’­æ”¾ï¼Œtrue-æ’­æ”¾ä¸­
        let lyricScale = 1;    // æ­Œè¯åˆå§‹ç¼©æ”¾æ¯”ä¾‹
        const scaleMin = 0.5;  // æœ€å°ç¼©æ”¾æ¯”ä¾‹
        const scaleMax = 3;    // æœ€å¤§ç¼©æ”¾æ¯”ä¾‹

        // 1. æ­Œè¯ç¼©æ”¾åŠŸèƒ½ï¼šç”µè„‘æ»šè½®+ç§»åŠ¨ç«¯åŒæŒ‡ç¼©æ”¾ï¼ˆå±…ä¸­ç¼©æ”¾ï¼Œæ”¯æŒé“ºæ»¡å±ï¼‰
        // ç”µè„‘ç«¯æ»šè½®ç¼©æ”¾
        lyricImg.addEventListener('wheel', function(e) {
            e.preventDefault();
            // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼šæ»šè½®å‘ä¸Šæ”¾å¤§ï¼Œå‘ä¸‹ç¼©å°
            lyricScale += e.deltaY * -0.001;
            // é™åˆ¶ç¼©æ”¾èŒƒå›´
            lyricScale = Math.min(Math.max(scaleMin, lyricScale), scaleMax);
            // åº”ç”¨ç¼©æ”¾
            this.style.transform = `scale(${lyricScale})`;
        });

        // ç§»åŠ¨ç«¯åŒæŒ‡ç¼©æ”¾
        let touchStart = {};
        lyricImg.addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                // è®°å½•åˆå§‹åŒæŒ‡ä½ç½®å’Œè·ç¦»
                const x1 = e.touches[0].clientX, y1 = e.touches[0].clientY;
                const x2 = e.touches[1].clientX, y2 = e.touches[1].clientY;
                touchStart.distance = Math.hypot(x1 - x2, y1 - y2);
                touchStart.currentScale = lyricScale;
            }
        });
        lyricImg.addEventListener('touchmove', function(e) {
            if (e.touches.length === 2) {
                e.preventDefault();
                // è®¡ç®—å½“å‰åŒæŒ‡è·ç¦»
                const x1 = e.touches[0].clientX, y1 = e.touches[0].clientY;
                const x2 = e.touches[1].clientX, y2 = e.touches[1].clientY;
                const currentDistance = Math.hypot(x1 - x2, y1 - y2);
                // è®¡ç®—æ–°çš„ç¼©æ”¾æ¯”ä¾‹
                lyricScale = (currentDistance / touchStart.distance) * touchStart.currentScale;
                // é™åˆ¶ç¼©æ”¾èŒƒå›´
                lyricScale = Math.min(Math.max(scaleMin, lyricScale), scaleMax);
                // åº”ç”¨ç¼©æ”¾
                lyricImg.style.transform = `scale(${lyricScale})`;
            }
        });

        // 2. æ’­æ”¾/åœæ­¢åˆ‡æ¢åŠŸèƒ½ï¼šä¸€ä¸ªæŒ‰é’®åˆ‡æ¢ï¼ŒåŒæ­¥çŠ¶æ€
        function togglePlayStop() {
            if (!player.src) { // æœªé€‰æ‹©æ­Œæ›²æ—¶æç¤º
                alert('è¯·å…ˆç‚¹å‡»æ­Œæ›²åˆ—è¡¨é€‰æ‹©æ­Œæ›²ï¼');
                return;
            }
            if (isPlaying) {
                // æ’­æ”¾ä¸­ â†’ åœæ­¢ï¼šæš‚åœæ’­æ”¾ï¼Œé‡ç½®è¿›åº¦ï¼ŒæŒ‰é’®æ˜¾ç¤ºâ€œæ’­æ”¾â€
                player.pause();
                player.currentTime = 0;
                playStopBtn.innerText = 'æ’­æ”¾';
                isPlaying = false;
            } else {
                // æœªæ’­æ”¾ â†’ æ’­æ”¾ï¼šå¼€å§‹æ’­æ”¾ï¼ŒæŒ‰é’®æ˜¾ç¤ºâ€œåœæ­¢â€
                player.play();
                playStopBtn.innerText = 'åœæ­¢';
                isPlaying = true;
            }
        }

        // 3. è¿›åº¦æ¡å®æ—¶æ›´æ–°+ç‚¹å‡»è°ƒæ•´è¿›åº¦
        // æ’­æ”¾æ—¶å®æ—¶æ›´æ–°è¿›åº¦æ¡
        player.addEventListener('timeupdate', function() {
            if (player.duration) {
                // è®¡ç®—æ’­æ”¾è¿›åº¦ï¼ˆç™¾åˆ†æ¯”ï¼‰
                const progress = (player.currentTime / player.duration) * 100;
                progressBar.value = progress;
            }
        });
        // ç‚¹å‡»è¿›åº¦æ¡è°ƒæ•´æ’­æ”¾ä½ç½®
        progressBar.addEventListener('input', function() {
            if (player.duration) {
                // æ ¹æ®è¿›åº¦æ¡å€¼è®¾ç½®æ’­æ”¾æ—¶é—´
                const seekTime = (this.value / 100) * player.duration;
                player.currentTime = seekTime;
            }
        });

        // 4. æ­Œæ›²æ’­æ”¾çŠ¶æ€åŒæ­¥ï¼šå¤–éƒ¨ç‚¹å‡»æ­Œæ›²æ’­æ”¾æ—¶æ›´æ–°æŒ‰é’®å’ŒçŠ¶æ€
        // é‡å†™æ’­æ”¾å‡½æ•°ï¼ˆé€‚é…åŸæœ‰script.jsçš„æ’­æ”¾é€»è¾‘ï¼‰
        window.playMusic = function(src, name, singer) {
            // è®¾ç½®æ­Œæ›²åœ°å€
            player.src = src;
            // å¼€å§‹æ’­æ”¾
            player.play();
            // æ›´æ–°çŠ¶æ€å’ŒæŒ‰é’®
            isPlaying = true;
            playStopBtn.innerText = 'åœæ­¢';
            // æ›´æ–°æ’­æ”¾ä¿¡æ¯
            document.getElementById('playerInfo').innerText = `${name} - ${singer}`;
            // åŸæœ‰æ­Œè¯æŒ‰é’®æ˜¾ç¤ºé€»è¾‘ä¸å˜
            const lyricBtn = document.getElementById('lyricBtn');
            const currentMusic = musicDb.find(item => item.src === src);
            lyricBtn.style.display = currentMusic && currentMusic.lyric ? 'block' : 'none';
        };

        // 5. æ­Œè¯æ˜¾ç¤º/éšè—ï¼šé‡ç½®ç¼©æ”¾æ¯”ä¾‹
        window.toggleLyric = function() {
            const lyricLayer = document.getElementById('lyricLayer');
            if (lyricLayer.style.display === 'none') {
                // æ‰“å¼€æ­Œè¯ï¼šé‡ç½®ç¼©æ”¾æ¯”ä¾‹ï¼Œæ˜¾ç¤ºå›¾å±‚
                lyricScale = 1;
                lyricImg.style.transform = `scale(${lyricScale})`;
                lyricLayer.style.display = 'flex';
            } else {
                // å…³é—­æ­Œè¯ï¼šéšè—å›¾å±‚
                lyricLayer.style.display = 'none';
            }
        };

        // 6. æ’­æ”¾å™¨ç»“æŸäº‹ä»¶ï¼šæ’­æ”¾å®Œæˆåé‡ç½®çŠ¶æ€
        player.addEventListener('ended', function() {
            isPlaying = false;
            playStopBtn.innerText = 'æ’­æ”¾';
            progressBar.value = 0;
        });
    </script>
</body>
</html>